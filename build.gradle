plugins {
  id 'com.github.ben-manes.versions' version "0.27.0"
  id 'base'
  id "org.podval.docbook-gradle-plugin" version "0.7.10"
  id 'idea'
}

repositories {
  jcenter()
}

docBook {
  document = "book"

  outputFormats = ["html", "pdf", "epub2"]

  parameters.common = [
          "chapter.autolabel": "1",
          "section.autolabel": "0",

          // Remove trailing period after honorific
          "punct.honorific"  : "",

          // Remove trailing period after run-in head (e.g., formal paragraph title)
          "runinhead.default.title.end.punct": ""
  ]

  parameters.htmlCommon = [
          // "role" attribute on "para" will become "class" in HTML
          "para.propagates.style": "yes",

          // Include page number in cross-references
          "insert.xref.page.number": "yes"
  ]

  parameters.pdf = [
          "title.font.family"       : "DejaVu Sans",
          "body.font.family"        : "DejaVu Sans",
          "sans.font.family"        : "DejaVu Sans",
          "monospace.font.family"   : "DejaVu Sans Mono",
          "symbol.font.family"      : "DejaVu Sans",
          // "footnote.font.size"   : "10"
          "body.font.master"        : "14",
          "body.start.indent"       : "0pt", // Suppress content indent
          "orderedlist.label.width" : "2em", // Some space for the list labels
          "keep.relative.image.uris": "yes" // TODO need this? XInclude shouldn't affect image URIs
  ]

  mathJax {
    isEnabled = false
  }
}

build.dependsOn processDocBook
build.doLast {
  project.sync {
//    from project.tasks.getByPath('processDocBook').outputDirectory
    from processDocBook.outputDirectory
    into 'docs/book'
  }
}

idea {
  project {
    jdkName = '1.8'
    vcs = 'Git'
  }

  module {
    excludeDirs += [
      file('.idea'),
      file('gradle')
    ]
  }
}
